<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <script id="allmobilize" src="/javascripts/adapt.min.js"></script>

    <title>意分享 - 收集最新资讯，分享无敌</title>
    <meta name="description" content="">

    <meta name="keywords" content="意分享 博客 NodeJS 跨平台 HTML5">
    <meta name="description" content="意分享，收集最新最前沿的资讯，打造分享平台。">
    <meta name="viewport" content="width=device-width">
    <meta name="generator" content="AllMobilize Cloud">
    <meta name="google-site-verification" content="LEa2SLHsvK8e7LePiRI8NjQQlz5MMNUInWNebNnt5xA" />

    <link rel="stylesheet" href="/stylesheets/bootstrap.min.css?v=1.5">
    <link rel='stylesheet' href='/stylesheets/css/index/main.css'/>
    <link rel="stylesheet" href="/stylesheets/bootstrap-responsive.css">
    <link charset="utf-8" rel="stylesheet" type="text/css" href="/stylesheets/css/topic/layout.css">
    <link rel="stylesheet" href="/stylesheets/style.css">
    <link rel="stylesheet" href="/stylesheets/css/prettify.css">
    <script src="/javascripts/jquery-1.9.1.min.js"></script>
    <script src="/javascripts/bootstrap.min.js"></script>
    <script src="/javascripts/topic.js"></script>
    <script src="/javascripts/prettify.js"></script>


    <style>
        #settings-menu {
            background-clip: padding-box;
            background-color: #FFFFFF;
            border: 1px solid rgba(0, 0, 0, 0.2);
            border-radius: 6px 6px 6px 6px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
            display: block;
            float: left;
            left: 3;
            right: -70px;
            list-style: none outside none;
            margin: 0.5 0 0;
            min-width: 160px;
            padding: 5px 0;
            position: absolute;
            top: 100%;
            z-index: 1000;
        }

        #settings-menu li {
            margin-left: 3px;
        }
        #settings-menu:after {
            left: 22px;
            right: auto;
        }
        #settings-menu:before {
            left: 22px;
            right: auto;
        }
    </style>
    <script>
        function setting_in() {
            $('#settings-menu').fadeIn();
        }
        function setting_out() {
            $('#settings-menu').fadeOut();
        }
    </script>
</head>
<body style="background-color:whitesmoke;font-family: '微软雅黑';">
<!--[if lt IE 7]><p class="chromeframe">Your browser is <em>ancient!</em> <a href="http://browsehappy.com/">Upgrade to a different browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.</p><![endif]-->
<!-- Header -->
<header class="">
    <div class="header navbar navbar-static-top navbar-fixed-top" style="background-color: whitesmoke;">
        <div class="navbar-inverse">
            <div class="container">
                <div class="pull-left">
                    <a href="/">
                        <img src="/images/logo.png" alt="意分享" class="logo">
                    </a>
                </div>
                <ul id ="navbar-menu" class="nav pull-left">
                    <li id="nav-home">
                        <a href="/">
                            <i class="icon-home"></i>首页
                        </a>
                    </li>
                    <li id="nav-features">
                        <a href="/about">
                            <i class="icon-user"></i>关于我们
                        </a>
                    </li>
                    <!--<li id="nav-cases">
                        <a href="/cases.html">
                            <i class="icon-search"></i>客户案例
                        </a>
                    </li>
                    <li id="nav-pricing">
                        <a href="/pricing.html">
                            <i class="icon-food"></i>套餐选择
                        </a>
                    </li>-->
                </ul>
                <ul id ="navbar-menu" class="nav pull-right">
                    <% if (session.is_login) { %>
                    <li><a href="#">欢迎您,<%= session.user.username %></a></li>
                    <li  ><!--<a href="/user/setting">设置</a>-->

                        <!--<div class="dropdown clearfix"  style="position:absolute;margin-top:20px;overflow:hidden;">-->
                       <!-- <ul id="settings-menu" class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu" onmouseout="">
                            <li style=" margin-left: 3px;"><a tabindex="-1" href="#">我的分享</a></li>
                            <li><a tabindex="-1" href="#">Another action</a></li>
                            <li><a tabindex="-1" href="#">Something else here</a></li>
                            <li class="divider"></li>
                            <li><a tabindex="-1" href="#">Separated link</a></li>
                        </ul>-->
                        <!-- </div>-->
                    </li>
                    <li><a onmousemove="javascript:setting_in();" >设置</a></li>
                    <li><a href="/logout">退出</a></li>
                    <% } else { %>
                    <li><a href="/signup">免费注册</a></li>
                    <li><a href="/login">登录</a></li>
                    <% } %>
                </ul>
            </div>
        </div>
    </div>
</header>

<!--<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>欢迎使用飞扬博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico" />
    <link rel='stylesheet' type="text/css" href='/stylesheets/css/login/bootstrap.min.css'/>
    <link rel='stylesheet' type="text/css" href='/stylesheets/css/index/main.css'/>
    <link href="/stylesheets/css/index/theme.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/css/index/layout.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/css/index.css" media="screen" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="/javascripts/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="/javascripts/bootstrap.min.js"></script>
    <script type="text/javascript" src="/javascripts/topic.js"></script>
    <script type="text/javascript" src="/javascripts/kindeditor/kindeditor-min.js"></script>
    <script type="text/javascript" src="/javascripts/kindeditor/lang/zh_CN.js"></script>




    <link charset="utf-8" rel="stylesheet" type="text/css" href="/stylesheets/css/topic/layout.css">
    <link rel="stylesheet" href="/stylesheets/style.css">

</head>

<body  data-target=".bs-docs-sidebar" data-spy="scroll" style="padding-bottom: 0px;font-family: '微软雅黑';">

<div class="navbar navbar-inverse navbar-fixed-top logged_out  windows  env-production" >
    <div class="navbar-inner">
        <div class="container">
            <a class="brand" title="飞扬博客" href="/">
                <img src="/images/LogoMaker.png" alt="飞扬博客">
            </a>

            <div class="nav-collapse collapse">
                <ul class="nav">
                    <li><a href="/">首页</a></li>
                    <li><a href="/about">关于我们</a></li>
                </ul>
            </div>
            <div class="nav-collapse collapse pull-right">
                <ul class="nav" id="info">
                    <% if (session.is_login) { %>
                    <li><a href="/topic/index">欢迎您,<%= session.user.username %></a></li>
                    <li><a href="/user/setting">设置</a></li>
                    <li><a href="/logout">退出</a></li>
                    <% } else { %>
                    <li><a href="/register">免费注册</a></li>
                    <li><a href="/login">登录</a></li>
                    <% } %>
                </ul>
            </div>
        </div>
    </div>
</div>-->
<script type="text/javascript">
    /*var editor;
    KindEditor.ready(function(K) {
        editor = K.create('textarea[name="t_content"]', {
            allowFileManager : true
        });
    });*/
</script>

<div id="wrapper">

    <div class="site clearfix" style="padding-top: 60px;">
        <div id="site-container" class="container clearfix">



            <div class="tabbable well" style="padding-top: 30px;background-color: #fff;"> <!-- Only required for left/right tabs -->
                <ul class="nav nav-tabs">
                    <li class="active"><a href="#tab1" data-toggle="contributions">发表文章</a></li>
                    <li><a href="/topic/list/<%= session.user._id %>" data-toggle="contributions">文章管理</a></li>
                    <li><a href="/topic/comment/<%= session.user._id %>" data-toggle="tab">评论管理</a></li>
                </ul>
                <div class="tabnav-right">
                </div>
                <div class="tab-content">
                    <div class="tab-pane active" id="tab1">
                        <p>
                        <form method="post" action="/topic/create">
                            <fieldset style="padding:0;border-width: 0;">

                                <% if (session.error.length) { %>
                                <div class="alert alert-error">
                                    <button type="button" class="close" data-dismiss="alert">&times;</button>
                                    <%= session.error %>
                                </div>
                                <% } %>


                                <form id='create_topic_form' action='/topic/create' method='post'>

                                    <div>
                                        <label class='bold' for='title'>标题</label>
                                        <div>

                                            <textarea class='span8' id='title' name='title' rows='3'></textarea>

                                            <p class='help-block'>字数控制在10到100个之间</p>
                                        </div>
                                    </div>
                                    <div class='sep10'></div>
                                    <div class='sep10'></div>
                                <div>
                                    <label class='bold' for='t_content'>内容和标签</label>
                                    <div class='tabbable'>
                                        <ul class='nav nav-pills'>
                                            <li class='active'><a href='#markdown' data-toggle='pill'>markdown</a></li>
                                            <li><a href='#preview' data-toggle='pill' class="preview-btn">预览</a></li>
                                            <li><a href='#tags'data-toggle='pill'>标签</a></li>
                                        </ul>
                                        <div class='tab-content'>
                                            <div class='active tab-pane' id='markdown'>
                                                <div id='wmd-button-bar'></div>
                                                <div class='input'>

                                                    <textarea class='span8' id='wmd-input' name='t_content' rows='20'></textarea>

                                                </div>
                                            </div>
                                            <div id='preview' class='tab-pane'>
                                                <div id='wmd-preview' class='wmd-preview topic-wmd-preview'></div>
                                            </div>
                                            <div id='tags' class='tab-pane'>
                                                <div class='tags_select'>

<span class='tag_selectable' tag_id='4efc3e39e49a048d71000169'>
	业界消息
</span>


<span class='tag_selectable' tag_id='4f178970d48ce1f82c00236f'>
	社区活动
</span>


<span class='tag_selectable' tag_id='4f17899ed48ce1f82c0023f6'>
	NAE交流
</span>


<span class='tag_selectable' tag_id='4f178985d48ce1f82c0023ae'>
	原创文章
</span>


<span class='tag_selectable' tag_id='4f17898dd48ce1f82c0023e9'>
	转载文章
</span>


<span class='tag_selectable' tag_id='4f17897cd48ce1f82c0023aa'>
	入门教程
</span>


<span class='tag_selectable' tag_id='4f178995d48ce1f82c0023ef'>
	技术讨论
</span>


<span class='tag_selectable' tag_id='4f1789a6d48ce1f82c002438'>
	东拉西扯
</span>


<span class='tag_selectable' tag_id='4f4e0eace1e0be951c017957'>
	NodeClub
</span>


                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <input type='hidden' id='topic_tags' name='topic_tags' value=''></input>
                                <input type='hidden' name='_csrf' value='W6G4mXMuA5B7VylYfdutrKhl' />
                    </form>



                                <!-- markdown editor -->
                                <script src='/javascripts/markdown/Markdown.Converter.js'></script>
                                <script src='/javascripts/markdown/showdown.js'></script>
                                <script src='/javascripts/markdown/Markdown.Editor.js'></script>

                                <script>
                                    $(document).ready(function () {
                                        var editors = {};
                                        function run_md_editor() {
                                            var converter = new Showdown.converter();
                                            editors[""] = new Markdown.Editor(converter);
                                            editors[""].run();
                                            /*
                                             editor.hooks.chain('onPreviewRefresh', function () {
                                             prettyPrint();
                                             });
                                             */
                                            $('.reply2_editor').each(function() {
                                                var editor_id = $(this).attr('id');
                                                var suffix = editor_id.slice(editor_id.indexOf('-'));
                                                editors[suffix] = new Markdown.Editor(converter, suffix);
                                                editors[suffix].run();
                                                /*
                                                 editor.hooks.chain('onPreviewRefresh', function () {
                                                 prettyPrint();
                                                 });
                                                 */
                                            });
                                        }
                                        run_md_editor();

                                        $('#wmd-input').mouseover(function(){
                                            $('#wmd-input').focus()
                                        });

                                        $('.reply2_btn').click(function () {
                                            var $btn = $(this);
                                            // var editor = $btn.parent().next('.reply2_area').find('.reply2_editor');
                                            var editor = $btn.parent().parent().find('.reply2_editor');
                                            editor.slideToggle('fast');
                                            editor.find('textarea').focus();
                                        });

                                        $('.reply2_at_btn').click(function () {
                                            var $btn = $(this);
                                            var editor = $btn.parents('.reply2_area').find('.reply2_editor');
                                            editor.show('fast');
                                            editor.find('textarea').focus();
                                            var user = $btn.parents('.reply2_item').find('.reply_author').find('a').html();
                                            var textarea = editor.find('textarea');
                                            if (textarea.val().indexOf(user) === -1) {
                                                textarea.val(textarea.val() + ' @' + user + ' ');
                                            } else {
                                                editor.hide('fast');
                                                textarea.val('')
                                            }
                                        });

                                        $('.reply2_submit_btn').click(function () {
                                            var $btn = $(this);
                                            var reply_id = $btn.attr('id');
                                            var content = $btn.parent().find('textarea').val();
                                            var data = {
                                                reply_id: reply_id,
                                                r2_content: content,
                                                _csrf: 'FPmQ3DBgMdJCKsb51Veg2z7I'
                                            };
                                            $.post('/515312285dff253b37181044/reply2', data, function (data) {
                                                if(data != ''){
                                                    $btn.parent().before(data);
                                                    $btn.parent().find('textarea').val('');
                                                    $btn.parent().find('.wmd-preview').html('');
                                                    prettyPrint();
                                                    $btn.parent().toggle();
                                                }
                                            });
                                        });
                                        $('.preview-btn').click(function() {
                                            var href = $(this).attr('href');
                                            var index = href.lastIndexOf('-');
                                            var suffix = index < 0 ? '' : href.slice(index);
                                            editors[suffix].makePreviewHtml();
                                            prettyPrint();
                                        });

                                        $('.reply_area').mouseover(function(){
                                            $(this).find('.reply2_btn').show();
                                        });
                                        $('.reply_area').mouseout(function(){
                                            $(this).find('.reply2_btn').hide();
                                        });

                                        $('.reply2_item').live('mouseover',function(){
                                            $(this).find('.reply2_at_btn').show();
                                        });
                                        $('.reply2_item').live('mouseout',function(){
                                            $(this).find('.reply2_at_btn').hide();
                                        });
                                        /*
                                         $(this).find('.reply2_btn').show();
                                         $(this).find('.reply2_at_btn').show();
                                         */
                                        $('#collect_btn').click(function(){
                                            var $me = $(this);
                                            var action = $me.attr('action');
                                            var data = {
                                                topic_id: '515312285dff253b37181044',
                                                _csrf: 'FPmQ3DBgMdJCKsb51Veg2z7I'
                                            };
                                            $.post('/topic/' + action, data, function(data) {
                                                if (data.status === 'success') {
                                                    if (action == 'collect') {
                                                        $me.html('取消收藏');
                                                        $me.attr('action','de_collect');
                                                    } else {
                                                        $me.html('加入收藏');
                                                        $me.attr('action','collect');
                                                    }
                                                    $me.toggleClass('btn-success');
                                                }
                                            }, 'json');
                                        });

                                        $('.delete_reply_btn, .delete_reply2_btn').live('click', function() {
                                            var $me = $(this);
                                            if (confirm('确定要删除此回复吗？')) {
                                                var reply_id = null;
                                                if ($me.hasClass('delete_reply_btn')) {
                                                    reply_id = $me.parents('.reply_item').attr('reply_id');
                                                }
                                                if ($me.hasClass('delete_reply2_btn')) {
                                                    reply_id = $me.parents('.reply2_item').attr('reply_id');
                                                }
                                                var data = {
                                                    reply_id: reply_id,
                                                    _csrf: "FPmQ3DBgMdJCKsb51Veg2z7I"
                                                };
                                                $.post('/reply/' + reply_id + '/delete', data, function (data) {
                                                    if (data.status === 'success') {
                                                        if($me.hasClass('delete_reply_btn')){
                                                            $me.parents('.reply_item').remove();
                                                        }
                                                        if($me.hasClass('delete_reply2_btn')){
                                                            $me.parents('.reply2_item').remove();
                                                        }
                                                    }
                                                }, 'json');
                                            }
                                            return false;
                                        });

                                        $('.delete_topic_btn').click(function () {
                                            var topicId = $(this).data('id');
                                            if (topicId && confirm('确定要删除此话题吗？')) {
                                                $.post('/topic/' + topicId + '/delete', { _csrf: $('#_csrf').val() }, function (result) {
                                                    if (!result.success) {
                                                        alert(result.message);
                                                    } else {
                                                        window.location.href = '/';
                                                    }
                                                });
                                            }
                                            return false;
                                        });

                                        var submit_btn;
                                        $('textarea').each(function(){
                                            $(this).focus(function(){
                                                var parent = $(this).parent().parent().parent().parent();
                                                var btn = parent.find('button');
                                                if(btn.html() == '回复'){
                                                    submit_btn = btn;
                                                }
                                            });
                                        });

                                        document.onkeyup=function(event) {
                                            if(window.ActiveXObject) {
                                                var keydown = window.event.keyCode;
                                                event=window.event;
                                            }else{
                                                var keydown = event.keyCode;
                                                if(event.ctrlKey == true && keydown == 13){
                                                    if(submit_btn){
                                                        submit_btn.click();
                                                    }
                                                }
                                            }
                                        };
                                    });
                                </script>




                                <!--<div>
                                    <label for='t_content' class="muted" style="line-height: 2;"><strong>文章内容和标签</strong></label>
                                    <div class='tabbable'>
                                        <ul class='nav nav-pills'>
                                            <li class='active'><a href='#markdown' data-toggle='pill'>编辑器</a></li>
                                            <li><a href='#tags'data-toggle='pill'>标签</a></li>
                                        </ul>
                                        <div class='tab-content'>
                                            <div class='active tab-pane' id='markdown'>

                                                <div id='wmd-button-bar'></div>
                                                <div class='input'>

                                                    <textarea  id='wmd-input' name='t_content' rows='20' style="width:866px;height:300px;visibility:hidden;"></textarea>

                                                </div>
                                            </div>
                                            <div id='preview' class='tab-pane'>
                                                <div id='wmd-preview' class='wmd-preview topic-wmd-preview'></div>
                                            </div>
                                            <div id='tags' class='tab-pane'>
                                                <div class='tags_select'>

                                    <span class='tag_selectable' tag_id='4efc3e39e49a048d71000169'>
	业界消息
</span>


<span class='tag_selectable' tag_id='4f178970d48ce1f82c00236f'>
	社区活动
</span>


<span class='tag_selectable' tag_id='4f17899ed48ce1f82c0023f6'>
	NAE交流
</span>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>-->


                                <label style="line-height: 3;"><strong>文章分类</strong></label>

                                <% if(categories.length) { %>
                                <% categories.forEach(function(category) { %>
                                <label class="radio inline">
                                    <input type="radio" name="categoryRadios" value="<%= category._id %>" checked>
                                    <%= category.typename %>
                                </label>
                                <% }) %>
                                <% } %>

                                <div class="alert alert-block" id="warning-info" style="margin-top: 20px;display: none;">
                                    <button type="button" class="close" data-dismiss="alert">&times;</button>
                                </div>
                                <div class="form-actions" style="padding-left: 0;">
                                    <button type="submit" class="btn btn-success" onclick="return submitValidate();">发&nbsp;&nbsp;布</button>
                                </div>

                            </fieldset>
                        </form>




                        </p>
                    </div>

                    <div class="tab-pane" id="tab3">
                        <p>Howdy, I'm in Section 2.</p>
                    </div>
                </div>
            </div>





        </div>
        <div class="context-overlay"></div>
    </div>
    <div id="footer-push"></div><!-- hack for sticky footer -->
</div><!-- end of wrapper - hack for sticky footer -->


    <% include ../common/foot.html %>

